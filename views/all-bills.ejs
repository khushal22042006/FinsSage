<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>All Transactions - FinSage</title>
  <link rel="icon" href="/images/logo.png.png" type="image/png" />
  <link rel="stylesheet" href="/stylesheets/dashboard.css" />
  <link rel="stylesheet" href="/stylesheets/dashboardmedia.css" />
  <link rel="stylesheet" href="/stylesheets/all-bills.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

</head>

<body id="body" class="min-h-screen ">

  <div class="flash-message-container" id="flashMessageJs" style="display: none; ">
  <span class="flash-message success" id="flashMessageText">Coming soon...</span>
</div>



        <div class="flex-grow-1 p-4">
      <!-- Top Bar -->
      <div class="Logo-Strip text-white d-flex flex-wrap justify-content-between align-items-center mb-4 position-relative">
        <h6 class="d-flex align-items-center gap-2">
        <img src="/images/logo.png.png" alt="logo" style="height: 32px; width: 32px; object-fit: contain;">
        FinSage
      </h6>

        <span class="greeting">Good morning, <%= user.name %> ðŸ‘‹</span>
        <div class="d-flex align-items-center gap-3">


                <form id="monthForm" method="GET" action="" class="d-flex align-items-center gap-2">
                <input
                    type="month"
                    name="month"
                    class="form-control form-control-sm"
                    style="width: auto;"
                    value="<%= selectedMonth %>"
                    placeholder="mm - yyyy"
                    id="monthInput"
                />
                <button type="submit" hidden></button>
                </form>
                    

          <button class="btn btn-light btn-sm" aria-label="Toggle Theme" id="theme-toggle"><i class="bi bi-moon"></i></button>
          <i class="bi bi-bell fs-5 position-relative">
            <span class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle"></span>
          </i>
          <div class="position-relative">
            <i class="bi bi-person-circle fs-5" id="profile-icon" style="cursor: pointer;"></i>
            <div class="profile-dropdown" id="profile-dropdown">
              <a href="#">Profile</a>
              <a href="#">Settings</a>
              <a href="/user/logout">Logout</a>
            </div>
          </div>
        </div>
      </div>
       <!-- main content -->
       <div class="container my-5 max-w-2xl mx-auto p-4 bg-white rounded-2xl shadow-md">
        <div class="text-center mb-4">
      <h2 class="text-2xl font-semibold text-white bg-[#1F4E79] section-title rounded-t-2xl">All bills</h2>
        </div>

      <% if (bills && bills.length > 0) { %>
      <% bills.forEach((bill, index) => { %>
        <div class="transaction-card fade-in">
          <div class="flex justify-between items-center">
            <div>
              <h5 class="font-semibold"><%= bill.billName %></h5>
              <p class="text-sm  ">â‚¹ <%= bill.amount %></p>
            </div>
            <button class="btn btn-sm btn-outline-primary toggle-details" data-index="<%= index %>">More...</button>
          </div>

          <div class="details mt-3 hidden" id="details-<%= index %>">
            <p><strong>Repeat:</strong> <%= bill.repeat %></p>
            <p><strong>Duedate:</strong> <%= new Date(bill.dueDate).toLocaleDateString() %></p>

              <div class="form-check mt-2">
                <input class="form-check-input" type="checkbox" disabled <%= bill.isPaid ? 'checked' : '' %> id="paidCheckbox-<%= index %>">
                <label class="form-check-label" for="paidCheckbox-<%= index %>">
                  Bill Paid
                </label>
              </div>

            <div class="flex gap-2 mt-3">
              <a href="/<%= user.userId %>/bill/<%= bill._id %>/edit" class="btn btn-sm btn-warning">Edit</a>
              <button class="btn btn-sm btn-danger" onclick="confirmDelete('<%= bill._id %>')">Delete</button>
            </div>
          </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-lg max-w-sm w-full dark-mode:bg-gray-700">
            <h3 class="text-lg font-semibold mb-4 text-red-600">Are you sure you want to delete this transaction?</h3>
                <form  action="/<%= user.userId %>/transaction/<%= bill._id %>/delete?_method=DELETE" method="POST"   id="deleteForm">
                <button type="submit" class="btn btn-danger w-full">Yes, delete it</button>
            </form>
            </div>
        </div>


      <% }) %>
      <% } else { %>
      <p class="text-center text-gray-600">No bills available.</p>
       <% } %>

       <div class="mt-4 text-center">
      <a href="/<%= user.userId %>/dashboard" class="inline-block px-4 py-2 text-white bg-gray-700 rounded-lg hover:bg-gray-800 text-sm">Back to Dashboard</a>
      </div>
     </div>


        <!-- Bottom Navigation Bar -->
      <div class="  bottom-nav d-flex justify-content-around  shadow-sm p-2 rounded position-sticky bottom-0 z-3" >

        <a href="/<%=user.userId%>/dashboard" class="text-decoration-none  text-center"><i class="bi bi-house fs-5"></i><br><small>Home</small></a>
        <a href="#" id="openAddModal" class="text-decoration-none text-center"><i class="bi bi-plus-circle fs-4"></i><br><small>Add</small></a>
         <a href="#"   id="aiBotBtn" class="text-decoration-none  text-center"><i class="bi bi-robot fs-5"></i><br><small>AIBot</small></a>
        </div>
  </div>

  <!-- Add Modal -->
<div id="addModal" class="modal-overlay d-none">
  <div class="modal-box card shadow-lg">
    <h5 class="mb-4 text-center">What would you like to add?</h5>
    <div class="d-flex flex-column gap-3">
      <a href="/<%=user.userId%>/transaction" class="btn btn-primary"> Add Transaction</a>
      <a href="/<%=user.userId%>/goal" class="btn btn-success"> Add Goal</a>
      <a href="/<%=user.userId%>/bill" class="btn btn-warning text-white"> Add Bill Reminder</a>
    </div>
    <button class="btn btn-secondary mt-4 w-100" id="closeAddModal">Cancel</button>
  </div>
</div>


<script src="/javascripts/all-bills.js"></script>

</body>
</html>
